# 요약: Qwen2.5-3B 온도-난이도 분석

**데이터셋:** MATH-500
**모델:** Qwen2.5-3B-Instruct
**알고리즘:** Best-of-N (BoN), Diverse Verifier Tree Search (DVTS)
**실험 설계:** 2×2 (2개 알고리즘 × 2개 기준 온도)

---

## 연구 질문

### 목표 1: 온도에 따라 문제를 다르게 풀게 되는가?
**질문:** 다양한 온도에서 문제를 다르게 풀게 되는가? 어떤 문제 유형이 어느 온도에서 가장 잘 풀리는가?

### 목표 2: 기준 온도 선택이 분석 결과에 미치는 영향
**질문:** 기준 온도(T=0.1 vs T=0.8) 선택이 난이도 분층화 및 최적 온도 발견에 어떤 영향을 미치는가?

---

## 핵심 통찰

**모든 분석에서 동일한 500개의 MATH 문제를 사용합니다.** 기준 온도는 **분층화 방법**이며, 데이터셋의 특성이 아닙니다. 문제 자체는 변하지 않으며, 난이도로 분류하는 방식만 변합니다.

---

## 주요 발견

### 발견 1: 기준 온도가 난이도 분층화에 현저한 영향을 미침

T=0.1 기준 대신 T=0.8 기준을 사용하면 문제가 난이도 수준에 따라 재분배됩니다:

**BoN 분포 변화 (ref0.1 → ref0.8):**
- Level 1 (쉬움): 225 → 198 문제 (-12%)
- Level 2: 27 → 42 문제 (+56%)
- Level 3: 23 → 28 문제 (+22%)
- Level 4: 33 → 50 문제 (+52%)
- Level 5 (어려움): 192 → 182 문제 (-5%)

**DVTS 분포 변화 (ref0.1 → ref0.8):**
- Level 1 (쉬움): 241 → 219 문제 (-9%)
- Level 2: 32 → 54 문제 (+69%)
- Level 3: 21 → 36 문제 (+71%)
- Level 4: 21 → 29 문제 (+38%)
- Level 5 (어려움): 185 → 162 문제 (-12%)

**해석:** T=0.8 기준은 더 적은 문제를 "쉬움"(Level 1)으로 분류하고 더 많은 문제를 중간 난이도(Level 2-4)로 분류합니다. T=0.8이 본래 더 가변적이기 때문에 기준 온도에서 문제가 더 어려워 보이는 것이 논리적입니다.

---

### 발견 2: BoN은 견고함, DVTS는 기준 온도에 민감함

**BoN 최적 온도 일관성: 4/5 수준 (80%)**

| Level | ref0.1 | ref0.8 | 일관성? |
|-------|--------|--------|---------|
| 1 | T0.1 | T0.1 | ✓ |
| 2 | T0.2 | T0.2 | ✓ |
| 3 | T0.1 | T0.2 | ✗ (경미함) |
| 4 | T0.4 | T0.4 | ✓ |
| 5 | T0.2 | T0.2 | ✓ |

**DVTS 최적 온도 일관성: 2/5 수준 (40%)**

| Level | ref0.1 | ref0.8 | 일관성? |
|-------|--------|--------|---------|
| 1 | T0.1 | T0.1 | ✓ |
| 2 | T0.8 | T0.8 | ✓ |
| 3 | T0.1 | T0.2 | ✗ |
| 4 | T0.4 | **T0.8** | ✗ (중대함) |
| 5 | **T0.8** | T0.2 | ✗ (중대함) |

**중대한 관찰:** DVTS는 **강한 알고리즘-기준선 상호작용**을 보여줍니다. DVTS의 최적 온도는 문제가 어떻게 분층화되는지에 따라 극적으로 변하며, 특히 어려운 문제(Level 4-5)에서 그렇습니다.

---

### 발견 3: 기본 능력은 기준 온도와 무관함 ✓

예상대로, 모델 성능은 기준선 전체에서 동일합니다:

**BoN 기본 능력:**
- T0.1: 0.534 (두 기준선 모두)
- T0.2: 0.533 (두 기준선 모두)
- T0.4: 0.531 (두 기준선 모두)
- T0.8: 0.504 (두 기준선 모두)

**DVTS 기본 능력:**
- T0.1: 0.558 (두 기준선 모두)
- T0.2: 0.566 (두 기준선 모두) ⭐ 최고
- T0.4: 0.565 (두 기준선 모두)
- T0.8: 0.555 (두 기준선 모두)

**DVTS 이점:** 모든 온도에서 BoN보다 +3.3%~+10.1% 높은 기본 정확도.

---

### 발견 4: 알고리즘 간 문제 분류 차이

**T=0.1 기준에서:**
- DVTS는 BoN보다 16개 더 많은 문제를 "쉬움"(Level 1)으로 분류
- DVTS는 BoN보다 7개 적은 "가장 어려운" 문제(Level 5)

**T=0.8 기준에서:**
- DVTS는 BoN보다 21개 더 많은 문제를 "쉬움"(Level 1)으로 분류
- DVTS는 BoN보다 20개 적은 "가장 어려운" 문제(Level 5)

**해석:** DVTS는 본래 더 쉬운 문제에 능력이 있어서, 동일한 기준 온도에서도 다른 난이도 분층화를 야기합니다.

---

## 연구 질문 답변

### 목표 1: 다양한 온도가 문제를 다르게 푸는가?

**예.** 온도는 문제 해결 성능에 중대한 영향을 미치지만, 그 효과는 **알고리즘에 따라 다릅니다**:

**BoN 온도 전략 (견고함):**
- **Level 1 (쉬움):** T0.1 일관성 최고 (0.997-0.998 정확도)
- **Level 2:** T0.2 일관성 최고 (0.926-0.937 정확도)
- **Level 3:** T0.1 또는 T0.2 좋은 성능 (~0.87-0.89 정확도)
- **Level 4 (어려움):** T0.4 일관성 최고 (0.758-0.800 정확도)
- **Level 5 (가장 어려움):** T0.2 일관성 최고 (0.527-0.536 정확도)

**패턴:** BoN은 모든 난이도 수준에서 낮음-중간 온도(T0.1-T0.4)를 선호합니다. 전략은 **난이도를 측정하는 방식과 무관하게 안정적**입니다.

**DVTS 온도 전략 (문맥 의존적):**
- **Level 1 (쉬움):** T0.1 일관성 최고 (0.993-0.995 정확도)
- **Level 2:** **T0.8** 놀랍게도 최고 (0.917-0.944 정확도)
- **Level 3-5:** 최적 온도가 기준선 간에 급격히 변함

**패턴:** DVTS는 **비단조 온도 선호도**를 보여줍니다. 중간 난이도 문제에서 **높은 온도(T0.8)를 선호**하지만, 어려운 문제의 최적 선택은 분층화 방법에 따라 다릅니다.

**핵심 통찰:** "어려운 문제에 최고의 온도는 무엇인가?"라는 질문은 DVTS에 대해 **보편적인 답이 없습니다**—난이도를 정의하는 방식에 따라 달라집니다.

---

### 목표 2: 기준 온도 선택이 분석 결론에 영향을 미치는가?

**BoN의 경우: 아니오 (대부분).** 5개 수준 중 1개만 최적 온도가 변경되고(Level 3: T0.1 → T0.2), 이것은 경미한 차이입니다. BoN의 온도 전략은 **분층화 방법에 견고**합니다.

**DVTS의 경우: 예 (현저하게).** 5개 수준 중 3개가 최적 온도를 변경하며, Level 4와 5에서 중대한 변화가 있습니다. DVTS의 최적 온도는 **분층화 방법에 따라 결정적으로 달라집니다**.

**왜 차이가 있는가?**

1. **BoN 샘플링은 단순함:** N개 완성을 독립적으로 샘플링하고 최고를 선택. 온도는 다양성에 영향을 미치지만, best-of-N 선택은 직관적입니다.

2. **DVTS는 복잡함:** PRM 유도가 있는 트리 탐색. 다음의 상호작용:
   - 온도 기반 탐색
   - PRM 기반 가지치기
   - 다양성 요구사항

   **문맥 의존적 최적점**을 만듭니다. 문제 난이도를 분류하는 방식은 어떤 온도 설정이 트리 탐색에서 탐색 vs 활용을 최적으로 균형 잡는지 영향을 미칩니다.

---

## 실무적 권장사항

### BoN 사용자를 위해

✅ **T=0.1 기준을 난이도 분층화에 사용** (더 안정적이고, 더 많은 문제를 쉬움으로 분류)

**온도 선택 가이드:**
- 쉬운 문제 (>80% 기준선 정확도): **T=0.1**
- 중간 문제 (40-80% 기준선 정확도): **T=0.2**
- 어려운 문제 (20-40% 기준선 정확도): **T0.4**
- 가장 어려운 문제 (<20% 기준선 정확도): **T=0.2**

**T=0.2를 가장 어려운 문제에 쓰는 이유?** 높은 온도는 문제가 근본적으로 너무 어려울 때 해결 품질을 개선하지 않으면서 잡음만 추가합니다.

### DVTS 사용자를 위해

⚠️ **기준선이 중요합니다!** 문제 분포에 따라 선택하세요:

**대부분의 문제가 쉬운 경우 (T=0.1에서 >50%):**
- T=0.1 기준 사용
- 쉬운 문제: T=0.1
- 중간 문제: T=0.8 (높은 다양성이 트리 탐색을 도움)
- 어려운 문제: T=0.4-0.8

**문제가 광범위하게 분포하는 경우:**
- T=0.8 기준 사용
- 쉬운 문제: T=0.1
- 중간 문제: T=0.8
- 어려운 문제: T0.2와 T0.8 모두 테스트

**일반적 DVTS 통찰:** DVTS는 중간 난이도 문제에 **높은 온도(T=0.8) 이점**이 있으며 탐색 다양성이 도움이 되지만, 트리 탐색 메커니즘은 매우 어려운 문제에 대해 최적 온도를 **문맥에 민감하게** 만듭니다.

### 연구자를 위해

1. **난이도 분층화 분석 제시 시 항상 기준선 보고**
2. **기준선 선택 민감도 테스트**, 특히 DVTS 같은 복잡한 알고리즘
3. **BoN이 더 좋은 기준선**, 분층화에 무감각하기 때문
4. **트리 탐색 알고리즘 평가 시 다양한 기준선 고려**
5. **문제 수준 분석** (분층화 간에 개별 문제 추적)이 더 깊은 통찰을 드러낼 것

---

## 향후 작업 미해결 질문

1. **문제 마이그레이션 분석:** 기준선 변경 시 어떤 특정 문제가 난이도 수준 간에 이동하는가? "경계선상의" 문제가 분류 불안정한가?

2. **조건부 최적 온도:** 두 기준선 모두 "Level 3"으로 분류되는 문제의 경우, 진정한 최적 온도는 무엇인가? 이는 분층화 효과를 실제 난이도와 분리할 것입니다.

3. **DVTS 트리 탐색 메커니즘:** DVTS가 Level 2 문제에서 T=0.8을 선호하는 이유? 높은 온도가 트리의 PRM 유도 탐색을 개선하는가?

4. **다수결 투표 저성능:** 다수결 투표가 가중치 결합을 지속적으로 저성능하는 이유? 투표 전략을 개선할 수 있는가?

5. **온도 스케줄링:** **적응형 온도** (높음에서 시작, 낮음으로 소멸)이 고정 온도 전략을 능가하는가?

6. **일반화:** 이 발견이 다음에 적용되는가:
   - 더 큰 모델 (7B, 32B)?
   - 다른 데이터셋 (AIME, AMC)?
   - 다른 PRM?

---

## 생성된 파일

### 시각화
- `difficulty_distributions_2x2_comparison.png` - 기준선 간 문제 재분배
- `optimal_temperature_heatmap_comparison.png` - 알고리즘 및 기준선별 온도 선호도
- `base_capability_comparison_2x2.png` - 모델 능력 검증

### 상세 보고서
- `stratification_comparison.md` - 문제 수 마이그레이션
- `optimal_temperature_comparison.md` - 온도 일관성 분석
- `base_capability_verification.md` - 기본 능력이 기준선 독립인지 검증

### 데이터 테이블
- `stratification_comparison.csv` - 문제 분포에 대한 수치 데이터

---

## 결론

이 분석은 **근본적인 알고리즘 차이**를 드러냅니다:

- **BoN**은 **문제 난이도에 내재적인** 온도 선호도를 갖습니다 (측정 방식과 무관)
- **DVTS**는 **문맥 의존적인** 온도 선호도를 갖습니다 (난이도 측정 방법에 민감)

이것은 다음에 중요한 함의를 갖습니다:
1. **실험 설계:** 알고리즘을 비교할 때 항상 일관된 기준선을 사용하세요
2. **알고리즘 개발:** DVTS 같은 트리 탐색 알고리즘은 적응형 온도 전략이 필요할 수 있습니다
3. **벤치마킹:** 기준선을 보고하고 민감도를 테스트하세요
4. **실용적 배포:** BoN이 더 견고함; DVTS는 신중한 온도 조정이 필요합니다

**"최고의 온도는 무엇인가?"라는 질문에 대한 답은 문제뿐만 아니라 알고리즘과 난이도를 측정하는 방식에도 달려있습니다.**
